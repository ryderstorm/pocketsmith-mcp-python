# 1) Create a branch

```bash
git checkout -b chore/oss-readiness-and-coderabbit
```

## Current status

- All tests passing; bug fix merged into `main`.
- Working branch: `docs/next-steps`.
- Goal: finalize next steps doc and prepare OSS readiness PR.

## Immediate next actions

- [ ] Add `.gitignore` entry for `repomix-output.xml`.
- [ ] Tighten README TL;DR and auth table per recommendations.
- [ ] Add MCP Inspector quick recipe snippet.
- [ ] Optional: add rate-limit surfacing and pagination helper.
- [ ] Create PR with OSS hygiene files and README updates.
- [ ] After merge: make repo Public and install CodeRabbit.

---

# 2) Add CodeRabbit config

**.coderabbit.yml**

```yaml
version: 1
reviews:
  path_filters:
    include:
      - "**/*.py"
      - "README.md"
      - ".github/**/*.yml"
  summary: true
  leave_redundant_comments: false
  behavior:
    nitpicks: true
    suggestions: true
    tests: true
    docs: true
  python:
    style: ruff
    typing: prefer_pep484
  focus:
    - security
    - error-handling
    - pagination
    - timeouts/retries
merge_gate:
  required: false     # keep optional; flip to true later
  threshold: low
```

# 3) OSS hygiene files

**CONTRIBUTING.md**

````md
# Contributing

Thanks for helping improve the PocketSmith MCP (Python).
- Use `uv` (or `pip`) to install dev deps: `uv sync --all-extras --dev`
- Run checks before pushing: `just fmt && just lint && just test` (or see the CI equivalents)
- Open a PR from a feature branch; small, focused changes are best.

## Commit & PR
- Conventional commits (`feat:`, `fix:`, `chore:`…) preferred.
- Include a brief rationale and testing notes in the PR description.

## Development quickstart
```bash
uv sync --dev
uvx pocketsmith-mcp  # or: python -m pocketsmith_mcp
````

## Code of Conduct

This project follows the Contributor Covenant (see CODE\_OF\_CONDUCT.md).

````

**CODE_OF_CONDUCT.md**
```md
# Code of Conduct
This project follows the Contributor Covenant v2.1.
Instances of abusive, harassing, or otherwise unacceptable behavior may be reported to the maintainers via GitHub issues or security contact in SECURITY.md.
````

**SECURITY.md**

```md
# Security Policy

## Supported versions
We support the latest minor `0.x` release.

## Reporting a vulnerability
Please open a **Private vulnerability report** in GitHub Security Advisories (preferred).
Do **not** include secrets or personal financial data in reports.

## Keys & Tokens
Use a **PocketSmith Access Token** or **Developer Key** locally. Do not commit credentials.
```

**.github/ISSUE\_TEMPLATE/bug\_report.yml**

```yaml
name: Bug report
description: Report a problem with the PocketSmith MCP
labels: [bug]
body:
  - type: textarea
    attributes:
      label: What happened?
      description: Clear steps to reproduce, expected vs actual
  - type: input
    attributes:
      label: Version
      description: Output of `pocketsmith-mcp --version` (or git SHA)
  - type: textarea
    attributes:
      label: Logs / stack trace
```

**.github/ISSUE\_TEMPLATE/feature\_request.yml**

```yaml
name: Feature request
description: Suggest an idea or new read-only tool/report
labels: [enhancement]
body:
  - type: textarea
    attributes:
      label: Problem
  - type: textarea
    attributes:
      label: Proposed solution
```

**.github/pull\_request\_template.md**

```md
## Summary
- What this changes and why

## Testing
- [ ] Manual run with Access Token / Developer Key
- [ ] Lint/tests pass locally

## Notes
- Any follow-ups (docs, examples, pagination, rate limits, etc.)
```

# 4) README upgrades (copy/paste)

Add near the top (after badges):

````md
## TL;DR

```bash
# Install & run (stdio)
uvx pocketsmith-mcp
# or:
python -m pocketsmith_mcp
````

Connect with **MCP Inspector** or **Goose** (Desktop/CLI), selecting a “stdio” server.

### Auth options

| Purpose                          | Var                         | Header                    |
| -------------------------------- | --------------------------- | ------------------------- |
| End-user workflows (recommended) | `POCKETSMITH_ACCESS_TOKEN`  | `Authorization: Bearer …` |
| Developer/testing                | `POCKETSMITH_DEVELOPER_KEY` | `X-Developer-Key: …`      |

> Project is **read-only by default** (safe). Autogenerated write tools are **off** unless explicitly enabled via env flag.

````

Add a small **Inspector** snippet:

```md
### MCP Inspector quick recipe

```json
{
  "mcpServers": {
    "pocketsmith": {
      "command": "pocketsmith-mcp"
    }
  }
}
````

````

# 5) (Optional) safer errors + rate-limit surfacing

If you have a central HTTP helper (e.g., using `httpx.AsyncClient`), wrap it like this:

```python
# pocketsmith_mcp/http.py (new or existing helper)
import httpx
from tenacity import retry, stop_after_attempt, wait_exponential

DEFAULT_TIMEOUT = 30.0

@retry(stop=stop_after_attempt(3), wait=wait_exponential(multiplier=0.5, max=8))
async def get_json(client: httpx.AsyncClient, url: str, headers: dict, params: dict | None = None):
    r = await client.get(url, headers=headers, params=params, timeout=DEFAULT_TIMEOUT)
    rate = {
        "x_rate_limit_limit": r.headers.get("X-RateLimit-Limit"),
        "x_rate_limit_remaining": r.headers.get("X-RateLimit-Remaining"),
        "x_rate_limit_reset": r.headers.get("X-RateLimit-Reset"),
        "retry_after": r.headers.get("Retry-After"),
    }
    if r.status_code == 401:
        raise RuntimeError("PocketSmith auth failed (401). Check ACCESS_TOKEN or DEVELOPER_KEY.")
    if r.status_code == 429:
        raise RuntimeError(f"Rate-limited (429). rate={rate}")
    r.raise_for_status()
    data = r.json()
    return {"data": data, "rate": rate}
````

Then in your MCP tool handlers, return `rate` alongside `data` or include it in `meta` so users see limits without guessing. Keep defaults **read-only**.

# 6) (Optional) conservative pagination helper

```python
async def paged(
    fetch_page, *, max_pages: int = 3, page: int = 1, **kwargs
):
    """fetch_page(page=, **kwargs) → returns list/[]; stop early if empty"""
    out = []
    for _ in range(max_pages):
        batch = await fetch_page(page=page, **kwargs)
        if not batch:
            break
        out.extend(batch)
        page += 1
    return out
```

Use this for “list\_\*” tools with small defaults so it stays fast/safe.

# 7) Commit, push, open a draft PR

```bash
git add .coderabbit.yml CONTRIBUTING.md CODE_OF_CONDUCT.md SECURITY.md \
  .github/ISSUE_TEMPLATE/bug_report.yml \
  .github/ISSUE_TEMPLATE/feature_request.yml \
  .github/pull_request_template.md README.md
git commit -m "chore(oss): CodeRabbit config, OSS hygiene, README quickstart/auth"
git push -u origin chore/oss-readiness-and-coderabbit

# If you use the GitHub CLI:
gh pr create --fill --draft
```

# 8) PR title & body (paste this)

**Title:** chore(oss): CodeRabbit + README quickstart/auth, OSS hygiene files

**Body:**

- Add **.coderabbit.yml** for PR reviews (focus: security, error-handling, pagination, timeouts)
- Add **CONTRIBUTING, SECURITY, CoC**, PR/Issue templates
- README: TL;DR install, **auth matrix**, Inspector snippet; clarify **read-only by default**
- (Optional) helpers for **rate-limit** surfacing and conservative **pagination**

> After merge: make repo **Public**, install **CodeRabbit** (free for public), enable check in branch protection.

---

If you want me to tailor the README edits to the exact sections/anchors in your repo, paste the current README.md top \~120 lines and I’ll return a drop-in patch.
